---
  - name: Applying kernel settings 
    hosts: all
    gather_facts: false
    tasks:
      - include_vars: kernel-tunables.yml

      - name: Configuring kernel parameters
        sysctl:
          name: "{{ item.param }}"
          value: "{{ item.value }}"
          sysctl_set: yes
          state: present
          reload: yes
          sysctl_file: "/etc/sysctl.d/99-cca-enforcement.conf"
        with_items: "{{ kernel_parameters }}"
        notify: Report change

    handlers:
      - name:  Report change   
        uri:
          url: http://localhost:9221/
          method: POST
          body: "{ \"message\": {\"hostname\": \"teste\", \"param\": \"testep\", \"value\": \"valor\"} }"
          validate_certs: no
          headers: {'content-type': 'application/json'}
          status: 201
          body_format: json